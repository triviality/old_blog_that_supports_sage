---
layout: post
title: Noncommutative Algebras in Sage
draft_tag: 
- Noncommutative Algebra
---

In this post, I'll demonstrate 3 ways to define non-commutative rings in Sage. They're essentially different ways of expressing the non-commutative relations in the ring:

  1. [Via `g_algebra`](http://doc.sagemath.org/html/en/reference/algebras/sage/algebras/free_algebra.html#sage.algebras.free_algebra.FreeAlgebra_generic.g_algebra){:target="_blank"}: define the relations directly
  1. [Via `NCPolynomialRing_plural`](http://www.sagemath.org/documentation/html/en/reference/polynomial_rings/sage/rings/polynomial/plural.html){:target="_blank"}: define a pair of structural matrices
  1. [Via a quotient of a letterplace ring](http://doc.sagemath.org/html/en/reference/rings/sage/rings/quotient_ring.html){:target="_blank"}: define the ideal generated by the relations (only works for homogeneous relations)
  
<!--more-->

As far as I know, all 3 methods rely on Sage's interface with [Singular](https://www.singular.uni-kl.de/index.php){:target="_blank"} and its non-commutative extension [Plural](https://www.singular.uni-kl.de/Manual/4-0-2/sing_469.htm){:target="_blank"}. 

In addition to all the documentation linked above, I also relied heavily on  Greuel and Pfister's [*A Singular Introduction to
Commutative Algebra*](http://www.cimpa-icpam.org/archivesecoles/20130130100834/singularbuch1-210.pdf){:target="_blank"}. Despite the title, it does have a pretty substantial section (1.9) devoted to non-commutative $G$-algebras.

## $U(\mathfrak{sl}_2)$ and its homogenization

The running example throughout this post will be the universal enveloping algebra $U(\mathfrak{sl}_2)$ over $\mathbb{Q}$. 

We'll define this to be the (non-commutative) $\mathbb{Q}$-algebra $U$ with generators $e,f,h$ subject to the relations

$$
[e,f] = h, \qquad [h,e] = 2e, \qquad [h,f] = -2f.
$$

If we set $e,f,h$ to have degree 1, these relations are not homogeneous. Their left-hand sides only have degree 2 terms, while their right-hand sides have degree 1 terms as well. This is fine with the first two methods, but won't work for method 3 (which requires homogeneous relations).

To demonstrate the third method, we'll define the $\mathbb{Q}$-algebra $H$ with generators $e,f,h,t$ subject to the homogeneous relations

$$
[t,e] = [t,f] = [t,h] = 0,
$$

$$
[e,f] = ht, \qquad [h,e] = 2et, \qquad [h,f] = -2ft.
$$

We can obtain $U$ both as a quotient and a localization of $H$:

$$
H/(1-t) \;\;\cong\;\; U \;\;\cong\;\; H[t^{-1}]_0.
$$

## $G$-algebras
Using the  [`g_algebra`](http://doc.sagemath.org/html/en/reference/algebras/sage/algebras/free_algebra.html#sage.algebras.free_algebra.FreeAlgebra_generic.g_algebra){:target="_blank"} method of Sage's `FreeAlgebra` class, we can simply plug our noncommutative relations in, and get our non-commutative ring. This is about as easy as it gets:

<div class="sage">
  <script type="text/x-sage">
F.<e,f,h> = FreeAlgebra(QQ,3)
U = F.g_algebra({f*e: e*f - h, h*e: e*h + 2*e, h*f: f*h-2*f})
U
  </script>
</div>

Let's unravel what's going on here.

### Monomial orderings and PBW basis
Most algorithms for commutative and non-commutative rings require an ordering on the generators. In our case, let's use the ordering

$$
e < f < h.
$$

This is implicitly stated in our code: we wrote `F.<e,f,h>` instead of `F.<h,e,f>`, for example.

A *standard word* is a monomial of the form

$$
e^if^jh^k, \qquad i,j,k \in \mathbb{N}
$$

In the polynomial ring $\mathbb{Q}[e,f,h]$, every monomial can be expressed in this form, so the set of standard words forms a $\mathbb{Q}$-basis for $\mathbb{Q}[e,f,h]$.

In a non-commutative ring, whether or not the standard words form a basis depends on what relations we have. Such a basis, if it exists, is called a [PBW basis](https://en.wikipedia.org/wiki/Poincar%C3%A9%E2%80%93Birkhoff%E2%80%93Witt_theorem){:target="_blank"}. 

The free algebra $F = \mathbb{Q}\langle e,f,h\rangle$ has no relations, so does not have a PBW basis. Fortunately, our algebra $U$ does have a PBW basis. 

This means that we can always express a non-standard monomial (e.g. $fe$) as a sum of standard monomials (e.g. $ef - h$). The non-commutative relations that define $U$ can thus be thought of as an algorithm for turning non-standard words into sums of standard words.

To do this in Sage, we define a [dictionary](https://docs.python.org/2/tutorial/datastructures.html#dictionaries){:target="_blank"} whose keys are non-standard words and values are the standard words they become.

In the above example, our dictionary was short enough to fit into one line, but we could also define a dictionary separately and pass it into `g_algebra`:

<div class="sage">
  <script type="text/x-sage">
F.<e,f,h> = FreeAlgebra(QQ,3)
 
U_relations = {
   f*e : e*f - h,
   h*e : e*h + 2*e,
   h*f : f*h - 2*f
}
 
U = F.g_algebra(U_relations)
U
   </script>
</div>

It's very important that the keys are non-standard words and the values are sums of standard words. Mathematically, the relation $fe = ef - h$ is the same as $ef = fe + h$, but if we replace `f*e : e*f - h` with `e*f : f*e + h` in the code, we'll get an error (try it!).

### What are $G$-algebras?
The reason why $U$ has a PBW basis is because it is a $G$-algebra. Briefly, $G$-algebras are algebras whose relations satisfy certain non-degeneracy conditions that make the algebra nice to work with. 

For a full definition of $G$-algebras, refer to [*A Singular Introduction to Commutative Algebra*](http://www.cimpa-icpam.org/archivesecoles/20130130100834/singularbuch1-210.pdf){:target="_blank"} or the [Plural manual](https://www.singular.uni-kl.de/Manual/4-0-2/sing_534.htm#SEC573){:target="_blank"}.

If $A$ is a $G$-algebra, then it has a PBW basis, is left and right Noetherian, and is an integral domain. More importantly (for this site at least!), it means that we can define $A$ in Singular/Plural, and hence in Sage.

## Structural matrices for a $G$-algebra
Another way of writing our non-commutative relations is

$$
\begin{pmatrix}
0 & fe & he \\
0 & 0  & hf \\
0 & 0 & 0
\end{pmatrix}
=
\begin{pmatrix}
0 & 1 & 1 \\
0 & 0 & 1 \\
0 & 0 & 0
\end{pmatrix}
\begin{pmatrix}
0 & ef & eh \\
0 & 0  & fh \\
0 & 0 & 0
\end{pmatrix}
+
\begin{pmatrix}
0 & -h & 2e \\
0 & 0  & -2f \\
0 & 0 & 0
\end{pmatrix}.
$$

Let

$$
N = \begin{pmatrix}
0 & fe & he \\
0 & 0  & hf \\
0 & 0 & 0
\end{pmatrix},
\qquad
C = \begin{pmatrix}
0 & 1 & 1 \\
0 & 0 & 1 \\
0 & 0 & 0
\end{pmatrix},
\qquad
S = \begin{pmatrix}
0 & ef & eh \\
0 & 0  & fh \\
0 & 0 & 0
\end{pmatrix},
\qquad
D = \begin{pmatrix}
0 & -h & 2e \\
0 & 0  & -2f \\
0 & 0 & 0
\end{pmatrix},
$$

so that $N = CS + D$. If we let $x_1 = e, x_2 = f, x_3 = h$, in accordance with our ordering $e < f < h$, then for $i < j$

$$
n_{ij} = x_j x_i, \qquad s_{ij} = x_i x_j.
$$

In other words, $N$ contains the non-standard words that we're trying to express in terms of the standard words in $S$. 

The matrices $C$ and $D$ are called the *structural matrices* of the $G$-algebra, and their entries are such that our relations may be written

$$
x_jx_i = c_{ij} x_i x_j  + d_{ij}, \qquad i < j
$$

with zeros everywhere else ($i \geq j$). If $C = D = 0$, the resulting algebra will be commutative.

We can use the structural matrices $C$ and $D$ to define our algebra via Sage's  [`NCPolynomialRing_plural`](http://www.sagemath.org/documentation/html/en/reference/polynomial_rings/sage/rings/polynomial/plural.html){:target="_blank"} function:

<div class="sage">
  <script type="text/x-sage">
from sage.rings.polynomial.plural import NCPolynomialRing_plural

R = QQ['e','f','h']
R.inject_variables()

C = matrix(R,3)
D = matrix(R,3)

C[0,1] = 1
C[0,2] = 1
C[1,2] = 1

D[0,1] = -h
D[0,2] = 2*e
D[1,2] = -2*f

show(C)
show(D)

U.<e,f,h> = NCPolynomialRing_plural(QQ, c = C, d = D, order = TermOrder('lex',3), category = Algebras(QQ))
U
  </script>
</div>

Note that `R` is a commutative polynomial ring. In fact, up till the point where we call `NCPolynomialRing_plural`, even the variables `e,f,h` are treated as commutative variables.

This method of defining $U$ is considerably longer and more prone to mistakes than using `g_algebra`. As stated in the [documentation](http://www.sagemath.org/documentation/html/en/reference/polynomial_rings/sage/rings/polynomial/plural.html){:target="_blank"}, this is not intended for use! I'm including it here because this is essentially how one would go about defining a $G$-algebra in Singular. In fact, the Sage method `g_algebra` calls `NCPolynomialRing_plural`, which in turn calls Singular. 

## Quotients of letterplace rings
Our final method for defining non-commutative rings makes use of [Sage's implementation of Singular's letterplace rings](http://doc.sagemath.org/html/en/reference/algebras/sage/algebras/letterplace/free_algebra_letterplace.html){:target="_blank"}. 

As mentioned at the start of this post, this method requires the relations to be homogeneous, so we'll work with $H$ instead of $U$. 

Let $\mathbb{Q}\langle e,f,h,t \rangle$ be the free algebra on 4 variables. Consider the two-sided ideal $I$ generated by the relations for $H$:

$$
I = (te - et, tf - ft, th - ht, ef - fe - ht, he - eh - 2et, hf - fh + 2ft)
$$

Then

$$
H = \mathbb{Q}\langle e,f,h,t \rangle/I.
$$

This can be expressed Sage-ly:

<div class="sage">
  <script type="text/x-sage">
F.<e,f,h,t> = FreeAlgebra(QQ, implementation='letterplace')

I = [
    t*e - e*t,
    t*f - f*t,
    t*h - h*t,
    e*f - f*e - h*t,
    h*e - e*h - 2*e*t,
    h*f - f*h + 2*f*t
]

H = F.quotient(F * I * F)
H
  </script>
</div>

The expression `F*I*F` is the two-sided ideal generated by elements in the list `I`.

Although $U$ cannot be defined using this method, $H$ can be defined using all three methods. As a (fun?) exercise, try defining $H$ using the other two methods.

## Difficulties
These methods can be used to define many non-commutative algebras such as the Weyl algebra and various enveloping algebras of Lie algebras. One can also define these algebras over fields other than $\mathbb{Q}$, such as $\mathbb{C}$ or $\mathbb{F}_p$.

However, we cannot define algebras over $\mathbb{Q}(q)$, the fraction field of $\mathbb{Q}[q]$:

<div class="sage">
  <script type="text/x-sage">
Qq =QQ['q'].fraction_field()
Qq.inject_variables()

F.<x,y> = FreeAlgebra(Qq,2)

F.g_algebra({y*x : q*x*y})  
  </script>
</div>

This is a problem if we want to define rings with relations such as

$$
yx = qxy.
$$

Such relations occur frequently when studying quantum groups, for example. 

This is suprising, because one can easily define $\mathbb{Q}(q)$ and non-commutative $\mathbb{Q}(q)$-algebras in Singular/Plural, which is what Sage is using. It seems that the problem is in Sage's wrapper for Singular/Plural, because Sage can't even pass the ring $\mathbb{Q}(q)$ to Singular. 

There's a [trac ticket](http://trac.sagemath.org/ticket/14886){:target="_blank"} for this problem, but until it gets resolved, we'll just have to define such rings directly in Singular/Plural. Thanks to the amazing capabilities of the [Sage Cell Server](https://sagecell.sagemath.org/){:target="_blank"}, we'll do this in the next post!
